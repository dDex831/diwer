<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>浩軒心願單分享</title>
  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- 你的 CSS / Bootstrap / FontAwesome 等 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    /* 一些必要的樣式，比如 .zoom-preview、.pdf-grid…… */
    body { background-color: #f6f1ee; }
    .zoom-preview { /* … */ }
    /* … 其餘省略 … */
  </style>
</head>
<body>

  <!-- 你原本的 HTML 結構：導覽列、輪播、商品卡、心願按鈕、傳到LINE按鈕、Toast…… -->
  <!-- 範例只秀核心： -->
  <div id="pdf-catalog"> 
    <!-- … 戶外 / 杯子 / 餐具 區塊，每個 .outdoor-item 都要有 data-id、data-name，h2 裡面放愛心按鈕 … -->
  </div>
  <div class="zoom-preview"></div>
  <div class="position-fixed top-0 end-0 p-3" style="z-index:1055">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto">系統通知</strong>
        <small class="text-muted">現在</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
      </div>
      <div class="toast-body">已加入心願單！</div>
    </div>
  </div>
  <button id="send-line" class="btn btn-success">傳到 LINE 好友</button>
  <button id="export-pdf" class="btn btn-dark">下載商品型錄</button>

  <!-- 依賴 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- 主程式 (LIFF＋心願單＋分享＋PDF) -->
  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    // 0. 換成你的 LIFF ID
    const LIFF_ID = '2007748054-9bD5ZjXA';
    await liff.init({ liffId: LIFF_ID });

    // 1. 產品目錄、Swiper、AOS、放大預覽……（省略，沿用你現有的）
    //    ……

    // 2. 心願單邏輯
    let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
    function refreshWishlistUI() {
      document.querySelectorAll('.btn-wishlist').forEach(btn => {
        const item = btn.closest('.outdoor-item');
        const inList = wishlist.some(x=>x.id===item.dataset.id);
        btn.classList.toggle('active', inList);
        const icon = btn.querySelector('i');
        icon.classList.toggle('fas', inList);
        icon.classList.toggle('far', !inList);
      });
    }
    refreshWishlistUI();
    document.querySelectorAll('.btn-wishlist').forEach(btn => {
      btn.addEventListener('click', () => {
        const item = btn.closest('.outdoor-item');
        const {id,name} = item.dataset;
        const url = item.querySelector('img.zoomable-img').src;
        const idx = wishlist.findIndex(x=>x.id===id);
        if (idx > -1) wishlist.splice(idx,1);
        else wishlist.push({id,name,url});
        localStorage.setItem('wishlist', JSON.stringify(wishlist));
        refreshWishlistUI();
      });
    });

    // 3. 點了才登入並分享
    document.getElementById('send-line').addEventListener('click', async () => {
      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }
      const list = JSON.parse(localStorage.getItem('wishlist') || '[]');
      if (!list.length) {
        return alert('心願單為空！');
      }
      const messages = list.map(item=>({
        type: 'image',
        originalContentUrl: item.url,
        previewImageUrl:    item.url
      }));
      try {
        await liff.shareTargetPicker(messages);
      } catch(e) {
        console.error(e);
        alert('分享失敗：'+ e.message);
      }
    });

    // 4. 匯出 PDF（沿用你現有的 html2pdf 邏輯）
    document.getElementById('export-pdf').addEventListener('click', async () => {
      // … 你的 html2pdf 程式 …
    });
  });
  </script>

</body>
</html>
